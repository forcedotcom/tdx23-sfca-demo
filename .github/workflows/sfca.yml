name: Review
on:
    workflow_dispatch:
    pull_request:
        types: [opened, synchronize, reopened]
        branches: [main]
jobs:
    review:
        name: ReviewSource
        runs-on: 'ubuntu-latest'
        steps:
            - name: Execute Code Analyzer
              uses: rmohan20/code-analyzer-action@interfacing
              with:
                  runtype: simple
                  engine: "pmd, sfge"
                  projectdir: "force-app/main/default"
                  outfile: "sfca_result.json"
            
            - name: Download results
              uses: actions/download-artifact@v3
              with:
                name: SFCA-Results

            - name: Read SFCA results
              id: get-sfca-results
              run: echo "SfcaResults=$(cat sfca_result.json)" >> $GITHUB_OUTPUT

            - name: Convert SFCA results to PR comments
              uses: rmohan20/code-analyzer-pr-buddy@tsaction
              with:
                github_token: "${{ secrets.GITHUB_TOKEN }}"
                jsonstring: "${{steps.get-sfca-results.outputs.SfcaResults}}"
